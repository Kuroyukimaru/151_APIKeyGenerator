<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Space Theme</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        body {
            font-family: Poppins, sans-serif;
            background: radial-gradient(circle at 20% 20%, #2b1055, #000015 80%),
                url("https://i.ibb.co/2SqcZ9K/stars2.png");
            background-size: cover;
            color: #e8f7ff;
            min-height: 100vh;
        }

        .glow {
            text-shadow: 0 0 10px #5cd3ff, 0 0 20px #5cd3ff;
        }

        .glass {
            background: rgba(20, 20, 40, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 25px rgba(120, 0, 255, 0.4),
                0 0 40px rgba(0, 189, 255, 0.2);
            backdrop-filter: blur(12px);
        }

        table th {
            color: #9ddcff;
            text-shadow: 0 0 7px #5cd3ff;
        }

        table td {
            color: #d6f2ff;
        }

        .btn-delete {
            background: linear-gradient(90deg, #ff0033, #ff006e);
            box-shadow: 0 0 12px rgba(255, 0, 80, 0.7);
        }

        .btn-delete:hover {
            transform: scale(1.07);
            box-shadow: 0 0 20px rgba(255, 0, 140, 0.9);
        }

        .btn-logout {
            background: linear-gradient(90deg, #4d00ff, #00b7ff);
            box-shadow: 0 0 12px rgba(0, 149, 255, 0.6);
        }

        .btn-logout:hover {
            transform: scale(1.05);
            box-shadow: 0 0 22px rgba(0, 170, 255, 0.8);
        }
    </style>
</head>

<body class="flex flex-col items-center p-6">

    <h1 class="text-4xl font-bold mb-8 text-cyan-200 glow">ðŸŒŒ Admin Dashboard</h1>

    <div class="w-full max-w-6xl p-6 rounded-xl glass">

        <table class="min-w-full divide-y divide-blue-300/30">
            <thead>
                <tr>
                    <th class="px-4 py-2">ID</th>
                    <th class="px-4 py-2">Firstname</th>
                    <th class="px-4 py-2">Lastname</th>
                    <th class="px-4 py-2">Email</th>
                    <th class="px-4 py-2">API Key</th>
                    <th class="px-4 py-2">Status</th>
                    <th class="px-4 py-2">Action</th>
                </tr>
            </thead>

            <tbody id="table-body" class="divide-y divide-white/10"></tbody>
        </table>

        <button onclick="logout()"
            class="mt-6 px-6 py-3 text-white rounded-lg btn-logout transition">
            ðŸš€ Logout
        </button>

    </div>

    <script>
        async function loadDashboard() {
            try {
                const res = await fetch('/admin/dashboard');
                const data = await res.json();
                const tbody = document.getElementById('table-body');
                tbody.innerHTML = '';

                data.users.forEach(user => {
                    const tr = document.createElement('tr');

                    const statusColor =
                        user.status === 'on'
                            ? 'bg-green-400/20 text-green-300 border border-green-400/40'
                            : 'bg-red-400/20 text-red-300 border border-red-400/40';

                    tr.innerHTML = `
                        <td class="px-4 py-3">${user.id}</td>
                        <td class="px-4 py-3">${user.firstname}</td>
                        <td class="px-4 py-3">${user.lastname}</td>
                        <td class="px-4 py-3">${user.email}</td>

                        <!-- FIXED: gunakan user.api_key (bukan user.apiKey) -->
                        <td class="px-4 py-3 break-words max-w-xs">${user.api_key || 'â€”'}</td>

                        <td class="px-4 py-3 text-center rounded-lg font-semibold ${statusColor}">
                            ${user.status}
                        </td>

                        <td class="px-4 py-3">
                            <button onclick="deleteUser(${user.id})"
                                class="px-4 py-2 text-white rounded-lg btn-delete transition">
                                Hapus
                            </button>
                        </td>
                    `;

                    tbody.appendChild(tr);
                });
            } catch (err) {
                console.error(err);
            }
        }

        async function deleteUser(userId) {
            if (!confirm("Yakin ingin menghapus user ini?")) return;

            const res = await fetch(`/admin/user/${userId}`, { method: 'DELETE' });
            const data = await res.json();

            if (data.success) loadDashboard();
            else alert("Gagal hapus user");
        }

        function logout() {
            fetch('/admin/logout', { method: 'POST' }).then(() => {
                window.location.href = 'admin-login.html';
            });
        }

        loadDashboard();
    </script>

</body>
</html>
